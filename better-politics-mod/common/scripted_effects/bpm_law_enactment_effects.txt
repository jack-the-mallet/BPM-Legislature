bpm_set_ig_enacting_law_stance_to_number = {
	set_variable = { name = bpm_ig_enacting_law_stance value = 0 }

	if = {
		limit = { owner = { enacting_any_law = yes }}
		if = {
			limit = {
				law_stance = {
					law = owner.currently_enacting_law.type
					value = strongly_approve
				}
			}
			set_variable = { name = bpm_ig_enacting_law_stance value = 2 }
		}
		else_if = {
			limit = {
				law_stance = {
					law = owner.currently_enacting_law.type
					value = approve
				}
			}
			set_variable = { name = bpm_ig_enacting_law_stance value = 1 }
		}
		else_if = {
			limit = {
				law_stance = {
					law = owner.currently_enacting_law.type
					value = disapprove
				}
			}
			set_variable = { name = bpm_ig_enacting_law_stance value = -1 }
		}
		else_if = {
			limit = {
				law_stance = {
					law = owner.currently_enacting_law.type
					value = strongly_disapprove
				}
			}
			set_variable = { name = bpm_ig_enacting_law_stance value = -2 }
		}
	}
}

bpm_set_ig_current_law_stance_to_number = {
	set_variable = { name = bpm_ig_current_law_stance value = 0 }

	save_scope_as = stance_ig

	owner = {
		every_law = {
			limit = { 
				type = { is_same_law_group_as = prev.owner.currently_enacting_law.type }
				owner = { has_law = prev.type }
			}
			scope:stance_ig = {
				set_variable = { name = current_law value = prev }
			}
		}
	}
	if = {
		limit = {
			law_stance = {
				law = var:current_law.type
				value = strongly_approve
			}
		}
		set_variable = { name = bpm_ig_current_law_stance value = 2 }
	}
	else_if = {
		limit = {
			law_stance = {
				law = var:current_law.type
				value = approve
			}
		}
		set_variable = { name = bpm_ig_current_law_stance value = 1 }
	}
	else_if = {
		limit = {
			law_stance = {
				law = var:current_law.type
				value = disapprove
			}
		}
		set_variable = { name = bpm_ig_current_law_stance value = -1 }
	}
	else_if = {
		limit = {
			law_stance = {
				law = var:current_law.type
				value = strongly_disapprove
			}
		}
		set_variable = { name = bpm_ig_current_law_stance value = -2 }
	}
}

bpm_set_ig_law_support_enacting_law = {
	set_variable = { 
		name = bpm_ig_law_support_enacting_law
		value = {
			add = var:bpm_ig_enacting_law_stance
			multiply = 25
		}
	}
}

bpm_set_ig_law_support_current_law = {
	set_variable = { 
		name = bpm_ig_law_support_current_law
		value = {
			subtract = var:bpm_ig_current_law_stance
			multiply = 15
		}
	}
}

bpm_set_party_whip_ig = {
	random_member = {
		save_scope_as = reference_ig
	}
	every_member = {
		if = {
			### Update most powerful IG if not set or if this IG is more powerful
			limit = {
				OR = {
					NOT = { scope:reference_ig = { has_variable = bpm_most_powerful_ig } }
					scope:reference_ig.var:bpm_most_powerful_ig.ig_clout < this.ig_clout
				}
			}
			scope:reference_ig = {
				set_variable = { name = bpm_most_powerful_ig value = prev }
			}
		}
	}
	every_member = {
		set_variable = {
			name = bpm_most_powerful_ig
			value = scope:reference_ig.var:bpm_most_powerful_ig
		}
	}
}

bpm_set_ig_fixed_law_support_from_party_whip = {
	if = {
		limit = { has_variable = bpm_most_powerful_ig }
		set_variable = {
			name = bpm_ig_fixed_law_support_from_party_whip
			# Unweighted law support
			value = {
				add = var:bpm_most_powerful_ig.var:bpm_ig_law_support_enacting_law
				add = var:bpm_most_powerful_ig.var:bpm_ig_law_support_current_law
			}
		}
	}
}

bpm_set_ig_law_support_ruler = {
	if = {
		limit = {
			exists = owner.ruler
		}
		owner.ruler = {
			bpm_set_ig_enacting_law_stance_to_number = yes
			bpm_set_ig_current_law_stance_to_number = yes
			bpm_set_ig_law_support_enacting_law = yes
			bpm_set_ig_law_support_current_law = yes
		}
	}
}

bpm_set_ig_law_support_fixed_vars = {
	bpm_set_ig_enacting_law_stance_to_number = yes
	bpm_set_ig_current_law_stance_to_number = yes
	bpm_set_ig_law_support_enacting_law = yes
	bpm_set_ig_law_support_current_law = yes
}

bpm_set_all_igs_law_support_fixed_vars = {
	every_interest_group = {
		bpm_set_ig_law_support_fixed_vars = yes
	}
	every_active_party = {
		bpm_set_party_whip_ig = yes
	}
	every_interest_group = {
		bpm_set_ig_fixed_law_support_from_party_whip = yes
	}
	bpm_set_ig_law_support_ruler = yes
}